let e,t,l,a,i={cellpadding:0,cellspacing:1,class:"xl-as"},s={colspan:20,class:"xl-aE"},x={class:"xl-az"};import n from"../../lib/magix.js";import o from"../../gallery/mx-dragdrop/index.js";n.applyStyle("xl-k",'[mx5-view^="undefined~xl/plugins/diamond/game"]{padding:5px}.xl-as{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.xl-at{height:60px;text-align:center;width:60px}.xl-au{background:url(//img.alicdn.com/tfs/TB1B3EYXkH0gK0jSZPiXXavapXa-60-60.jpg) no-repeat}.xl-av{display:inline-block;height:40px;width:40px}.xl-aw{background:url(//img.alicdn.com/tfs/TB1KawWXeL2gK0jSZFmXXc7iXXa-40-40.gif) no-repeat}.xl-ax{background:url(//img.alicdn.com/tfs/TB1mJoTXa67gK0jSZFHXXa9jVXa-40-40.gif) no-repeat;left:-100000px;position:absolute}.xl-ay{left:320px;top:395px;width:112px}.xl-az,.xl-ay{height:22px;position:absolute}.xl-az{left:350px;top:45px}.xl-aA{left:320px}.xl-aB,.xl-aA{height:22px;position:absolute;top:340px}.xl-aB{left:384px}.xl-aC:before{color:green;content:"\u221a";font-weight:700}.xl-aD:before,.xl-aC:before{position:absolute;right:3px;top:0}.xl-aD:before{color:red;content:"x"}.xl-aD,.xl-aC{position:relative}.xl-aE{font-size:12px;padding:5px 6px}');let p=[[[-1,-1,0,0,0,-1,-1],[-1,-1,0,1,0,-1,-1],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[-1,-1,0,0,0,-1,-1],[-1,-1,0,0,0,-1,-1]],[[-1,-1,0,0,0,-1,-1],[-1,-1,0,1,0,-1,-1],[0,0,0,1,0,0,0],[0,1,1,1,1,1,0],[0,0,0,1,0,0,0],[-1,-1,0,1,0,-1,-1],[-1,-1,0,0,0,-1,-1]],[[-1,-1,0,1,0,-1,-1],[-1,-1,0,1,0,-1,-1],[0,1,1,1,1,1,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[-1,-1,1,1,1,-1,-1],[-1,-1,1,1,1,-1,-1]],[[-1,-1,0,1,0,-1,-1],[-1,-1,1,1,1,-1,-1],[0,1,1,1,1,1,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[-1,-1,1,1,1,-1,-1],[-1,-1,1,1,1,-1,-1]],[[-1,-1,0,0,0,-1,-1],[-1,-1,0,0,0,-1,-1],[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,1,1,1,1,0],[-1,-1,0,0,0,-1,-1],[-1,-1,0,0,0,-1,-1]],[[-1,-1,0,0,0,-1,-1],[-1,-1,0,1,0,-1,-1],[0,0,1,1,1,0,0],[0,1,1,1,1,1,0],[1,1,1,1,1,1,1],[-1,-1,0,0,0,-1,-1],[-1,-1,0,0,0,-1,-1]],[[-1,-1,0,1,0,-1,-1],[-1,-1,1,1,1,-1,-1],[0,1,1,1,1,1,0],[1,1,1,1,1,1,1],[0,1,1,1,1,1,0],[-1,-1,1,1,1,-1,-1],[-1,-1,0,0,0,-1,-1]],[[-1,-1,1,1,1,-1,-1],[-1,-1,1,1,1,-1,-1],[1,1,0,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[-1,-1,1,1,1,-1,-1],[-1,-1,1,1,1,-1,-1]],[[-1,-1,1,1,1,-1,-1],[-1,-1,1,1,1,-1,-1],[1,1,1,1,1,1,1],[1,1,1,0,1,1,1],[1,1,1,1,1,1,1],[-1,-1,1,1,1,-1,-1],[-1,-1,1,1,1,-1,-1]]],r={8:"\u4f20\u7edf\u578b",7:"\u6234\u7ef4\u65af\u8df3\u8dc3",6:"\u4e94\u8fb9\u5f62",5:"\u5927\u91d1\u5b57\u5854",4:"\u91d1\u5b57\u5854",3:"\u53f0\u706f",2:"\u53e4\u5b57\u5f62",1:"\u5927\u5341\u5b57",0:"\u5341\u5b57\u67b6"},c="\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".split(""),f={5:"\u9887\u597d",4:"\u5f88\u597d",3:"\u806a\u660e",2:"\u5c16\u5b50",1:"\u5927\u5e08"},y="\u6e38\u620f\u7ed3\u675f\uff0c\u6ca1\u6709\u53ef\u4ee5\u79fb\u52a8\u7684\u9752\u86d9\u4e86\uff5e<br/>\u60a8\u7684\u6210\u7ee9\u662f\uff1a{score}<br/>\u5355\u51fb\u4e0a\u4e0b\u4e00\u5173\u6216\u91cd\u65b0\u5f00\u59cb\u65b0\u7684\u6e38\u620f";export default n.View.extend({tmpl:(n,o,p)=>{let r,c,f,y,g,{size:u,result:d,tip:h,desc:_}=n;y=[];for(let t=0,l=u.length;t<l;t++){f=[];for(let l=0,a=u[t].length;l<a;l++)-1!=u[t][l]?(c=[],1===u[t][l]&&c.push(o("span",{class:"xl-av xl-aw",x:l,y:t,"mx5-mousedown":p+"\x1e_aw()"})),f.push(o("td",{class:"xl-at xl-au",id:"main_"+l+"_"+t},c))):e?f.push(e):f.push(e=o("td",{_:"_",class:"xl-at"}));y.push(o("tr",0,f))}return c=[o(0,d,1)],f=[o("td",s,c)],y.push(o("tr",0,f)),g=[o("tbody",0,y)],r=[o("table",i,g)],y=[o(0,h)],g=[o("div",0,y)],y=[o(0,_)],g.push(o("div",0,y)),r.push(o("div",x,g),o("span",{class:"xl-av xl-ax",id:p+"_active"})),g=[t||(t=o(0,"\u4e0a\u4e00\u5173"))],r.push(o("button",{class:"xl-aA xl-an","mx5-click":p+"\x1e_ay()"},g)),g=[l||(l=o(0,"\u4e0b\u4e00\u5173"))],r.push(o("button",{class:"xl-aB xl-an","mx5-click":p+"\x1e_ax()"},g)),g=[a||(a=o(0,"\u91cd\u65b0\u5f00\u59cb"))],r.push(o("button",{class:"xl-an xl-ay","mx5-click":p+"\x1e_az()"},g)),o(p,0,r)},init(){this._ao=0,this.set({result:"\u9f20\u6807\u62d6\u52a8\u4efb\u610f\u9752\u86d9\u5f00\u59cb\uff0c\u62d6\u52a8\u8fc7\u7a0b\u4e2d\u4f1a\u6709\u76f8\u5e94\u7684\u63d0\u793a<br/>\u60a8\u9700\u8981\u62d6\u52a8\u9752\u86d9\u8df3\u8fc7\u5176\u5b83\u9752\u86d9\uff0c\u8df3\u8fc7\u7684\u88ab\u5403\u6389\uff0c\u5269\u4f59\u9752\u86d9\u8d8a\u5c11\u8d8a\u597d<br/>\u5f53\u53ea\u5269\u4e00\u4e2a\u9752\u86d9\uff0c\u4e14\u5728\u6b63\u4e2d\u4f4d\u7f6e\u65f6\uff0c\u5219\u662f\u6700\u7ec8\u7684\u80dc\u5229"})},render(){let e=this,t=e._ao,l=p[t],a=[];for(let e=0;e<l.length;e++)a.push(l[e].slice());e._ap=a,e.digest({size:a,desc:r[t],tip:"\u7b2c"+c[t]+"\u5173"})},"{change.level}"(e){let t,l=p.length-1,a=this;e?a._ao<l&&(a._ao++,t=1):a._ao>0&&(a._ao--,t=1),t&&a.render()},_at(){let e=this._ap,t={},l=0,a=!0;for(let t=0,i=e.length,s=i-2;t<i;t++){for(let i=0,x=e[t].length,n=x-2;i<x;i++)if(-1!=e[t][i])if(e[t][i]&&l++,t<s){if(i<n){if(1==e[t][i]){if(1==e[t][i+1]&&0===e[t][i+2]){a=!1;break}if(1==e[t+1][i]&&0===e[t+2][i]){a=!1;break}}else if(0===e[t][i]){if(1==e[t][i+1]&&1==e[t][i+2]){a=!1;break}if(1==e[t+1][i]&&1==e[t+2][i]){a=!1;break}}}else if(1==e[t][i]){if(1==e[t+1][i]&&0===e[t+2][i]){a=!1;break}}else if(0===e[t][i]&&1==e[t+1][i]&&1==e[t+2][i]){a=!1;break}}else if(1==e[t][i]){if(1==e[t][i+1]&&0===e[t][i+2]){a=!1;break}}else if(0===e[t][i]&&1==e[t][i+1]&&1==e[t][i+2]){a=!1;break}if(!a)break}return t._aq=a,t._ar=a&&1==l&&1==e[3][3],t._as=l,t},_au(e,t){let l=null,a=this.root.getBoundingClientRect(),i=(e.x-a.left)/60|0,s=(e.y-a.top)/60|0,x=this._ap;return i<x[0].length&&s<x.length&&(!t||t.x!=i||t.y!=s)&&(l={x:i,y:s}),l},_av(e,t){let l={can:!1,eatList:[]},a=!0,i=[],s=!1,x=this._ap;if(x[t.y][t.x])return l;if((e={x:e.x,y:e.y}).y==t.y){for(;e.x!=t.x;)if(t.x>e.x?e.x++:e.x--,a){if(1!=x[e.y][e.x]){s=!0;break}i.push({x:e.x,y:e.y}),a=!1}else if(e.x!=t.x){if(0!==x[e.y][e.x]){s=!0;break}a=!0}s||(l.can=!0,l.eatList=i)}else if(e.x==t.x){for(;e.y!=t.y;)if(t.y>e.y?e.y++:e.y--,a){if(1!=x[e.y][e.x]){s=!0;break}i.push({x:e.x,y:e.y}),a=!1}else if(e.y!=t.y){if(0!==x[e.y][e.x]){s=!0;break}a=!0}s||(l.can=!0,l.eatList=i)}return l},"_aw<mousedown>"(e){let t=this,l=e.eventTarget,a=l.getBoundingClientRect(),i=n.node(this.id+"_active"),s=t.root.getBoundingClientRect();l.style.visibility="hidden";let x,o,p=a.left-s.left,r=a.top-s.top;i.style.left=p+"px",i.style.top=r+"px";let c,g,u={x:l.getAttribute("x"),y:l.getAttribute("y")};this._d(e,(l=>{l.preventDefault(),x=l.pageX-e.pageX+p,o=l.pageY-e.pageY+r,i.style.left=x+"px",i.style.top=o+"px";let a=t._au({x:l.pageX,y:l.pageY},u),s=a!=g;if(a&&g&&(s=a.x!=g.x||a.y!=g.y),s&&(g=a,c&&(c.style.opacity=1,c.classList.remove("xl-aC"),c.classList.remove("xl-aD")),a&&(c=n.node("main_"+a.x+"_"+a.y),c))){c.style.opacity=.7,t._av(u,a).can?c.classList.add("xl-aC"):c.classList.add("xl-aD")}}),(e=>{let a=t._au({x:e.pageX,y:e.pageY},u),s=!1;if(a){let e=t._av(u,a);if(e.can){let l=t._ap;l[u.y][u.x]=0,l[a.y][a.x]=1;for(let t,a=0,i=e.eatList.length;a<i;a++)t=e.eatList[a],l[t.y][t.x]=0;if(e=t._at(),e._aq){let t;t=e._ar?"\u5929\u624d\uff01":f[e._as]?f[e._as]+"\uff0c\u8fd8\u6709"+e._as+"\u4e2a\u9752\u86d9":"\u4e00\u822c\uff0c\u8fd8\u6709"+e._as+"\u4e2a\u9752\u86d9",this.set({result:y.replace("{score}",t)})}s=!0}else l.style.visibility="visible"}else l.style.visibility="visible";i.style.left="-10000px",c&&(c.style.opacity=1,c.classList.remove("xl-aC"),c.classList.remove("xl-aD")),s&&this.digest({size:this._ap})}))},"_ax<click>":function(){this["{change.level}"](!0)},"_ay<click>":function(){this["{change.level}"]()},"_az<click>":function(){this.render()}}).merge(o);