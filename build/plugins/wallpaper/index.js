import"../../gallery/mx-more/index.js";let t,e={class:"xl-cz"},i={class:"xl-cD"};import l from"../../lib/magix.js";import s from"../../os/wallpaper.js";import a from"../../lib/agent.js";l.applyStyle("xl-s",".xl-cz{background:#ddd;color:#333;height:28px;line-height:28px;padding:0 26px;position:sticky;top:0;z-index:2}.xl-cA{cursor:pointer;float:left;padding:0 5px}.xl-cB{background:#fff}.xl-cC{background-color:#8881;background-repeat:no-repeat;background-size:contain;cursor:pointer;float:left;height:200px;margin:5px;transition:all .2s;width:350px}.xl-cC:hover{box-shadow:0 3px 6px 0 rgba(0,0,0,.08);transform:scale(1.05)}.xl-cD{display:table}");let r=null,c=0,o=[],p=t=>{let e=t.split("x"),i=0|e[0],l=0|e[1],s=350/i,a=200/l,r=s>a?a:s;return{width:i*r|0,height:l*r|0}};export default l.View.extend({tmpl:(l,s,a,r,c,o,p)=>{let d,h,n,g,x=[],{error:u,cats:m,cId:f,loading:b,list:_,resize:w}=l;if(u)x.push(s(0,u));else{n=[];for(let t=m.length,e=0;e<t;e+=1){let t=m[e];h=[s(0,t.name)],d="xl-cA",t.id==f&&(d+=" xl-cB"),n.push(s("div",{"mx5-click":t.id!=f&&a+"\x1e_bV({id:'"+p(t.id)+"'})",class:d},h))}if(x.push(s("div",e,n)),b)t?x.push(t):(n=[s(0,"loading...")],x.push(t=s("div",{_:"_",class:"xl-w"},n)));else{n=[];for(let t=_.length,e=0;e<t;e+=1){let t=_[e];g="";let i=w(t.resolution),l=i.width,r=i.height;g+=" ";let c=t.url.replace("bdr/__85",`bdr/${l}_${r}_80`);n.push(s("div",{class:"xl-cC",style:"background-image:url("+c+")",title:t.utag,"mx5-click":a+"\x1e_ah({thumb:'"+p(c)+"',src:'"+p(t.url)+"'})"}))}x.push(s("div",i,n),s("div",{"mx5-owner":a,"mx5-from":a,"mx5-intersect":a+"\x1e_aJ()","mx5-view":"~xl/gallery/mx-more/index"}))}}return s(a,0,x)},init(){this.set({size:20,start:0,list:[],resize:p})},assign:()=>!1,async render(){try{let t=await new Promise((async(t,e)=>{if(r)t(r);else if(c)o.push([t,e]);else{c=1,o.push([t,e]);try{let t=await a.request("http://wallpaper.apc.360.cn/index.php?c=WallPaperAndroid&a=getAllCategories",864e5,!0),e=JSON.parse(t);c=0;for(let[t]of o)t(r=e.data)}catch(t){c=0;for(let[,e]of o)e(t)}}})),e=this.get("cId"),i=l.mark(this,"_aH");e||(e=t[0].id);let s=this.get("start"),p=this.get("list"),d=this.get("size"),h=await(async(t,e,i)=>{let l=await a.request(`http://wallpaper.apc.360.cn/index.php?c=WallPaper&a=getAppsByCategory&cid=${t}&start=${e}&count=${i}`,0,!0);return JSON.parse(l)})(e,s,d);i()&&(p.push(...h.data),this.digest({cId:e,loading:!1,cats:t,list:p}))}catch(t){this.digest({error:t})}delete this._aI},"_bV<click>"(t){let{id:e}=t.params;this.digest({list:[],loading:!0,start:0,cId:e}),this.root.scrollTop=0,this.render()},"_ah<click>"(t){let{thumb:e,src:i}=t.params;s._ac(e,i)},"_aJ<intersect>"(){if(!this.get("loading")&&!this._aI){this._aI=1;let t=this.get("start")+this.get("size");this.set({start:t}),this.render()}}});