let e,t,a={class:"xl-aU"},o={class:"xl-aS"},l={class:"xl-aV"},s={class:"xl-aW"},r={class:"xl-aX"},i={class:"xl-aY"},d={class:"xl-a4"},p={class:"xl-a5"};import n from"../../lib/magix.js";import h from"../../gallery/mx-dragdrop/index.js";import x from"../../lib/cron.js";import y from"./days.js";n.applyStyle("xl-n",'.xl-aR{background:#0002;border-radius:5px;opacity:.1;overflow:hidden;transition:all .5s}.xl-aR:hover{opacity:.8}.xl-aS{background:#bbb;height:4px}.xl-aT{background:#888;height:100%}.xl-aU{background:#000a;border-radius:4px;font-size:12px;left:0;padding:4px;position:absolute;top:0;transform:translate(100px,-40px)}.xl-aU:after{border:6px solid #0000;border-top-color:#000a;content:" ";height:0;left:50%;position:absolute;top:100%;width:0}.xl-aV{bottom:0;color:#fff2;cursor:move;font-size:140px;left:0;position:absolute;right:0}.xl-aV,.xl-aW{text-align:center}.xl-aW{border-collapse:collapse;border-spacing:0;width:100%}.xl-aX{background:#0005}.xl-aY{font-size:18px}.xl-aZ{border-radius:4px;cursor:pointer;height:30px;padding:0;position:relative;width:50px}.xl-a0,.xl-a0:hover{background:#0004}.xl-a1{color:red}.xl-a2{color:green}.xl-a3{right:5px;top:-2px}.xl-a3,.xl-a4{font-size:12px;position:absolute;transform:scale(.6)}.xl-a4{bottom:-4px;right:-3px}.xl-a5{font-size:12px;left:3px;position:absolute;top:-7px;transform:scale(.6)}.xl-a6{color:#ffd73a}');let m="\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split(""),g={year:2012,month:12,day:22,name:"\u599e\u599e"};export default n.View.extend({tmpl:(n,h,x)=>{let y,m,g,u,c,f,b,w,k,v,{esDays:T,days:D,percent:_,month:S,weekText:M,weeks:z,year:R,day:Y,workdays:j,holidays:V,birthday:W,solarTerms:X}=n;m="";let H=Math.ceil(T);m+=" \u4eca\u5e74\u5171"+D+"\u5929\uff0c ",m+=0==H?" \u4eca\u5929\u662f\u6700\u540e\u4e00\u5929 ":" \u8fd8\u6709"+H+"\u5929 ",g=[h(0,m)],v=[h("div",a,g)],g=[h("div",{class:"xl-aT",style:"width:"+_+"%"})],v.push(h("div",o,g)),g=[h(0,S)],v.push(h("div",l,g)),k=[],c=[];for(let e=M.length,t=0;t<e;t+=1){u=[h(0,M[t])],c.push(h("td",r,u))}k.push(h("tr",0,c));for(let a=z.length,o=0;o<a;o+=1){let a=z[o];c=[];for(let o=a.length,l=0;l<o;l+=1){let o=a[l],s=`${o.year}-${o.month}-${o.day}`;u=[],o.otherMonth||(w=[h(0,o.day)],u.push(h("div",i,w)),1===j[s]?e?u.push(e):(w=[h(0,"\u73ed")],u.push(e=h("div",{_:"_",class:"xl-a3"},w))):1===V[s]&&(t?u.push(t):(w=[h(0,"\u5047")],u.push(t=h("div",{_:"a",class:"xl-a3"},w)))),X[s]&&(w=[h(0,X[s])],u.push(h("div",d,w))),o.month==W.month&&o.day==W.day&&(w=[h(0,W.name)],u.push(h("div",p,w)))),f="xl-aZ",o.year==R&&o.month==S&&o.day==Y&&(f+=" xl-a0"),1===j[s]?f+=" xl-a1":1===V[s]&&(f+=" xl-a2"),o.month==W.month&&o.day==W.day&&(f+=" xl-a6"),b=s,1===j[s]?b+=" \u4e0a\u73ed":1===V[s]&&(b+=" \u653e\u5047"),b+=" ",X[s]&&(b+=""+X[s]),b+=" ",o.month==W.month&&o.day==W.day&&(b+=W.name+"\u751f\u65e5\uff0c\u4eca\u5e74"+(o.year-W.year)+"\u5c81\u5566\uff5e"),c.push(h("td",{class:f,title:o.otherMonth&&b},u))}k.push(h("tr",0,c))}return g=[h("tbody",0,k)],v.push(h("table",s,g)),y=[h("div",{class:"xl-aR","mx5-mousedown":x+"\x1e_aR()"},v)],h(x,0,y)},init(){this.set({birthday:g,weekText:m,weekStart:0});let e=this.render.bind(this);x._s(e,6e5),this.ondestroy=()=>{x._t(e)}},assign:()=>!1,async render(){let e=new Date,t=e.getFullYear(),a=e.getMonth()+1,o=e.getDate(),l=new Date(t,0,1,0,0,0).getTime(),s=new Date(t+1,0,1,0,0,0).getTime();e.setHours(0,0,0,0);let r,i=864e5,d=(e.getTime()-l+i)/(s-l)*100,p=(s-l)/i,h=(s-e.getTime()-i)/i,x=(7-this.get("weekStart")+new Date(t,a-1,1).getDay())%7,m=[],g=[],u=((e,t)=>32-new Date(e,t-1,32).getDate())(t,a);for(r=1;r<=x;r++)g.push({otherMonth:!0});for(r=1;r<=u;r++)g.push({year:t,day:r,month:a}),(r+x)%7==0&&(m.push(g),g=[]);let c=g.length;if(c){let e=7;for(r=c;r<e&&(g.push({otherMonth:!0}),(r+1)%7!=0||(m.push(g),g=[],6!=m.length));r++);}let f=n.mark(this,"_aH"),{queryWorkAndHolidays:b,querySolarTerms:w}=y,[k,{workdays:v,holidays:T}]=await Promise.all([w(),b(e)]);f()&&this.digest({year:t,holidays:T,workdays:v,solarTerms:k,month:a,day:o,days:p,esDays:h,percent:d.toFixed(2),weeks:m})},"_aR<mousedown>"(e){let t=this.root,a=parseInt(getComputedStyle(t).left),o=parseInt(getComputedStyle(t).top);this._d(e,(l=>{let s=l.pageX-e.pageX,r=l.pageY-e.pageY,i=a+s,d=o+r;t.style.left=i+"px",t.style.top=d+"px"}))}}).merge(h);