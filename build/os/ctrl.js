import e from"../lib/magix.js";let t=[],i=0,o=[];export default{_x(e,i){t.push(e),t["\x1f"+e.appId]={_v:5e3+i,_w:1}},_y:()=>t,_A(e){delete t["\x1f"+e];for(let i=t.length;i--;)if(t[i].appId==e){t.splice(i,1);break}this._z()},_w(e){t["\x1f"+e]._w=1},_B(e){t["\x1f"+e]._w=0,this._z()},_C(l,_){let n=_.appId;if(t["\x1f"+n]){this._z(n);let t=e.node(n);if(t){let i=e.Vframe.byNode(t);i.invoke("assign",_)&&i.invoke("render")}}else{o.length=0;let e=document.createElement("div"),d=t.length;e.id=n,document.body.append(e);let p=Object.assign({},_),s=p.dockX,a=p.dockY,f=0;a||(a=30*i+30,f=1),s||(s=30*i+150,f=1),f&&++i>5&&(i=0),p.left=s,p.top=a,p.zIndex=5e3+d,p.minWidth||(p.minWidth=150),p.minHeight||(p.minHeight=100),l.owner.mount(e,"~xl/os/dialog",p),this._x(p,d),setTimeout(()=>{this._z(n)},50)}},_D(e){let i,o,l;for(let _=t.length;_--;)if(i=t[_],e){if(i.appId==e){t.splice(_,1),o=!0;break}}else if((l=t["\x1f"+i.appId])._w){t.splice(_,1),o=!0;break}return o&&t.push(i),o?i:null},_E(){for(let i=t.length;i--;){let o=t[i].appId,l=t["\x1f"+o];if(l._v!=5e3+i){l._v=5e3+i;let t=e.node(o),_=e.Vframe.byNode(t);_&&_.invoke("assign",[{zIndex:5e3+i}])&&_.invoke("render")}}},_z(i,l){let _,n,d;o.length=0,i!=t._F?((d=t["\x1f"+t._F])&&d._H&&(d._H=0,(_=e.node(t._F))&&(n=e.Vframe.byNode(_))&&n.invoke("_I")),(d=this._D(i))?(i=d.appId,(d=t["\x1f"+i])._H||(d._H=1,d._w=1,(_=e.node(i))&&(n=e.Vframe.byNode(_))&&n.invoke("_z"),t._F=i),this._E()):t._F=""):l&&(_=e.node(i))&&(n=e.Vframe.byNode(_))&&(n.invoke("_G"),(d=t["\x1f"+i])._w=0)},_J(){if(o.length){let e=[];for(let t of o)e.push(t);for(let t of e)this._z(t)}else{let i=[];for(let o of t){if(t["\x1f"+o.appId]._w){let t=e.node(o.appId),l=t&&e.Vframe.byNode(t);l&&(l.invoke("_G"),i.push(o.appId))}}o.push(...i)}}};